<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <link rel="stylesheet" type="text/css" href="../plugins/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="../styles/index.css">
    <link rel="stylesheet" href="../styles/icon/iconfont.css">
</head>
<body>
<div id="app">
    <div>
        <div class="filter-container">
            <el-button type="primary" class="butT" @click="deleteAll">批量删除</el-button>
            <el-input placeholder="用户ID" v-model="pagination.id" style="width: 200px;" class="filter-item" clearable> </el-input>
            <template>
                <el-select v-model="pagination.sex" clearable placeholder="请选择">
                    <el-option
                            v-for="item in SexChoice"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                    </el-option>
                </el-select>
            </template>
            <el-button @click="getAll()" class="dalfBut">搜索</el-button>
        </div>
        <el-table  current-row-key="id" :data="dataList" stripe highlight-current-row @selection-change="handleSelectionChange"  border>
            <el-table-column type="selection" ></el-table-column>
            <el-table-column label="用户ID" prop="id" align="center" ></el-table-column>
            <el-table-column label="用户头像" prop="avator" align="center" >
                <template slot-scope="scope" >
                    <div>
                        <el-image :src="picUrl+scope.row.avator" style="width: 100px;height: 100px"></el-image>
                    </div>
                </template>
            </el-table-column>
            <el-table-column label="用户名" prop="username"  align="center" ></el-table-column>
            <el-table-column label="性别" prop="sex" align="center">
                <template slot-scope="scope">
                    <div>{{ changeSex(scope.row.sex) }}</div>
                </template>
            </el-table-column>
            <el-table-column label="创建时间" prop="createTime"  align="center">
                <template slot-scope="scope">
                    <div>{{ getBirth(scope.row.createTime) }}</div>
                </template>
            </el-table-column>
            <el-table-column label="手机号码" prop="phoneNum" align="center" ></el-table-column>
            <el-table-column label="操作" align="center" width="315">
                <template slot-scope="scope">
                    <el-button @click="goCommentPage(scope.row)">定单详情</el-button>
                    <el-button type="danger"  size="mini" @click="handleDelete(scope.row)">删除</el-button>
                </template>
            </el-table-column>
        </el-table>
        <!--分页组件-->
        <div class="pagination-container" style="text-align: center">
            <el-pagination
                    background
                    class="pagiantion"
                    @current-change="handleCurrentChange"
                    :current-page="pagination.currentPage"
                    :page-size="pagination.pageSize"
                    layout="total, prev, pager, next, jumper"
                    :total="pagination.total">
            </el-pagination>
        </div>

    </div>
</div>

<!-- 开发环境版本，包含了有帮助的命令行警告 -->
<script src="../plugins/vue/vue.js"></script>
<!-- 引入组件库 -->
<script src="../plugins/element-ui/lib/index.js"></script>
<!-- 引入axios -->
<script src="../plugins/axios/axios.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data:{
            dataList: [],
            multipleSelection: [],//批量删除记录
            pagination: {//分页相关模型数据
                currentPage: 1,//当前页码
                pageSize:5,//每页显示的记录数
                total:0,//总记录数
                id:'',
                sex:''
            },
            picUrl:'http://localhost:8080',
            SexChoice:[
                {
                    value: '1',
                    label: '男'
                },
                {
                    value: '0',
                    label: '女'
                }],

        },
        created(){

        },
        mounted(){
            this.getAll();
        },
        methods:{
            changeSex(value) {
                if (value === 0) {
                    return "女";
                } else if (value === 1) {
                    return "男";
                }
            },
            getBirth(cellValue) {
                if (cellValue == null || cellValue == "") return "";
                const date = new Date(cellValue);
                const year = date.getFullYear();
                const month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                const day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                return year + "-" + month + "-" + day;
            },
            //切换页码
            handleCurrentChange(currentPage) {
                //修改页码值为当前选中的页码值
                this.pagination.currentPage = currentPage;
                //执行查询
                this.getAll();
            },
            getAll() {
                param = "?id=" + this.pagination.id;
                param +="&sex="+this.pagination.sex;

                axios.get("/consumer/" + this.pagination.currentPage + "/" + this.pagination.pageSize + param).then((res) => {
                    this.pagination.pageSize = res.data.data.size;
                    this.pagination.currentPage = res.data.data.current;
                    this.pagination.total = res.data.data.total;
                    this.dataList = res.data.data.records;
                });
            },

            //删除用户
            handleDelete(row) {
                this.$confirm("此操作永久删除当前用户信息，是否继续？", "提示", {type: "info"}).then(() => {
                    axios.delete("/consumer/" + row.id).then((res) => {
                        if (String(res.data.code) === '1') {
                            this.$message.success(res.data.msg);
                        } else {
                            this.$message.error(res.data.msg);
                        }
                    }).finally(() => {

                        //2.重新加载数据
                        this.getAll();
                    });
                }).catch(() => {
                    this.$message.info("取消操作");
                });
            },
            //删除批量用户
            handleAllDelete(row) {
                axios.delete("/consumer/" + row.id)
            },
            //批量删除
            deleteAll(){
                this.$confirm("此操作永久删除当前歌单信息，是否继续？", "提示", {type: "info"}).then(() => {
                    for (let item of this.multipleSelection.value) {
                        this.handleAllDelete(item);
                    }
                }).finally(()=>{
                    this.getAll();
                    this.multipleSelection.value = [];
                }).catch(()=>{
                    this.$message.info("取消操作");
                });
            },
            handleSelectionChange(val) {
                this.multipleSelection.value = val;
            },
        }
    })
</script>
</body>
</html>